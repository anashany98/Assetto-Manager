import{r as d,u as y,j as e,C as R,k as f,b as E,U as I,a as g,A as b}from"./index-MjGtIaAt.js";import{u as L}from"./useMutation-Ckz2NycH.js";import{c as x}from"./utils-BykweIWy.js";import{C as N}from"./check-DDMqjJty.js";import{C as v}from"./circle-alert-9EthxjUH.js";import{C as P}from"./clock-DpL4IKBu.js";import{L as w}from"./loader-circle-DSpMC2cv.js";import{T as O}from"./timer-CamBLO3n.js";import{P as F,M as q}from"./phone-C4d7JN57.js";import{M as A}from"./map-pin-BuEIuJfX.js";import"./clsx-B-dksMZM.js";const M=[{value:30,label:"30 minutos"},{value:60,label:"1 hora"},{value:90,label:"1h 30min"},{value:120,label:"2 horas"}];function Y(){const[r,m]=d.useState(1),[l,k]=d.useState(new Date),[n,h]=d.useState(null),[p,S]=d.useState(null),[a,i]=d.useState({customer_name:"",customer_email:"",customer_phone:"",num_players:1,duration_minutes:60,notes:""}),{data:j}=y({queryKey:["settings"],queryFn:async()=>{const s=await g.get(`${b}/settings`);return Array.isArray(s.data)?s.data:[]}}),u=j?.find(s=>s.key==="bar_name")?.value||"VRacing Bar",_=j?.find(s=>s.key==="bar_logo")?.value||"/logo.png",{data:C,isLoading:D}=y({queryKey:["public-slots",l.toISOString().split("T")[0]],queryFn:async()=>(await g.get(`${b}/bookings/available`,{params:{target_date:l.toISOString().split("T")[0]}})).data}),o=L({mutationFn:async s=>(await g.post(`${b}/bookings/`,s)).data,onSuccess:s=>{S(s),m(3)}}),z=()=>{!n||!a.customer_name||o.mutate({...a,date:l.toISOString().split("T")[0],time_slot:n})},T=()=>{const s=[];for(let t=0;t<14;t++){const c=new Date;c.setDate(c.getDate()+t),s.push(c)}return s};return r===3&&p?e.jsx("div",{className:"min-h-screen bg-gray-950 flex flex-col items-center justify-center p-6 text-white",children:e.jsxs("div",{className:"w-full max-w-md text-center",children:[e.jsx("div",{className:"w-20 h-20 mx-auto bg-green-600 rounded-full flex items-center justify-center mb-6 animate-bounce",children:e.jsx(N,{size:40})}),e.jsx("h1",{className:"text-3xl font-black uppercase tracking-tight mb-2",children:"¡Reserva Confirmada!"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"Te hemos enviado un email con los detalles"}),e.jsxs("div",{className:"bg-gray-900 border border-gray-800 rounded-2xl p-6 text-left space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Nº Reserva"}),e.jsxs("span",{className:"font-mono font-bold text-blue-400",children:["#",p.id]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Fecha"}),e.jsx("span",{className:"font-bold",children:l.toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long"})})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Horario"}),e.jsx("span",{className:"font-bold text-green-400",children:n})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Jugadores"}),e.jsx("span",{className:"font-bold",children:a.num_players})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Duración"}),e.jsxs("span",{className:"font-bold",children:[a.duration_minutes," min"]})]})]}),e.jsxs("p",{className:"mt-6 text-amber-400 text-sm",children:[e.jsx(v,{size:14,className:"inline mr-1"}),"Recuerda llegar 10 minutos antes"]}),e.jsx("button",{onClick:()=>window.location.href="/",className:"mt-6 px-6 py-3 bg-blue-600 hover:bg-blue-500 rounded-xl font-bold transition-colors",children:"Volver al Inicio"})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-950 text-white",children:[e.jsx("div",{className:"bg-gray-900 border-b border-gray-800 px-6 py-4",children:e.jsxs("div",{className:"max-w-2xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:_,alt:u,className:"h-10 w-10 object-contain"}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-black text-lg uppercase tracking-tight",children:u}),e.jsx("p",{className:"text-xs text-gray-500",children:"Sistema de Reservas"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("div",{className:x("w-8 h-8 rounded-full flex items-center justify-center font-bold",r>=1?"bg-blue-600":"bg-gray-800"),children:"1"}),e.jsx("div",{className:x("w-8 h-1 rounded",r>=2?"bg-blue-600":"bg-gray-800")}),e.jsx("div",{className:x("w-8 h-8 rounded-full flex items-center justify-center font-bold",r>=2?"bg-blue-600":"bg-gray-800"),children:"2"})]})]})}),e.jsxs("div",{className:"max-w-2xl mx-auto p-6",children:[r===1&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-black uppercase tracking-tight mb-1",children:"Elige Fecha y Hora"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Selecciona cuándo quieres venir a correr"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-gray-400 uppercase font-bold block mb-2",children:[e.jsx(R,{size:14,className:"inline mr-1"})," Fecha"]}),e.jsx("div",{"data-testid":"date-scroll",className:"flex gap-2 overflow-x-auto pb-2 scrollbar-thin",children:T().map(s=>{const t=s.toDateString()===l.toDateString(),c=s.toDateString()===new Date().toDateString();return e.jsxs("button",{onClick:()=>{k(s),h(null)},className:x("flex-shrink-0 w-16 py-3 rounded-xl text-center transition-all",t?"bg-blue-600 text-white":"bg-gray-800 hover:bg-gray-700",c&&!t&&"ring-2 ring-blue-500/50"),children:[e.jsx("div",{className:"text-[10px] uppercase font-bold text-gray-400",children:s.toLocaleDateString("es-ES",{weekday:"short"})}),e.jsx("div",{className:"text-xl font-black",children:s.getDate()}),e.jsx("div",{className:"text-[10px] text-gray-500",children:s.toLocaleDateString("es-ES",{month:"short"})})]},s.toISOString())})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-gray-400 uppercase font-bold block mb-2",children:[e.jsx(P,{size:14,className:"inline mr-1"})," Horario Disponible"]}),D?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(w,{className:"animate-spin text-blue-500",size:32})}):e.jsx("div",{className:"grid grid-cols-4 gap-2",children:C?.slots?.map(s=>e.jsxs("button",{disabled:!s.available,onClick:()=>h(s.time_slot),className:x("py-3 rounded-xl text-center font-bold transition-all",s.available?n===s.time_slot?"bg-green-600 text-white scale-105 ring-2 ring-green-400":"bg-gray-800 hover:bg-gray-700":"bg-gray-900 text-gray-700 cursor-not-allowed"),children:[e.jsx("div",{className:"text-sm",children:s.time_slot.split("-")[0]}),s.available&&e.jsxs("div",{className:"text-[9px] text-gray-400 mt-0.5",children:[s.remaining_slots," libre",s.remaining_slots!==1&&"s"]})]},s.time_slot))})]}),e.jsxs("button",{onClick:()=>m(2),disabled:!n,className:"w-full py-4 bg-blue-600 hover:bg-blue-500 disabled:bg-gray-800 disabled:text-gray-600 rounded-xl font-bold uppercase tracking-wide transition-all flex items-center justify-center gap-2",children:["Continuar",e.jsx(f,{size:20})]})]}),r===2&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>m(1),className:"text-gray-500 hover:text-white text-sm mb-2 flex items-center gap-1",children:[e.jsx(f,{className:"rotate-180",size:16})," Volver"]}),e.jsx("h2",{className:"text-xl font-black uppercase tracking-tight mb-1",children:"Tus Datos"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Completa tu información para confirmar"})]}),e.jsxs("div",{className:"bg-gray-900 border border-gray-800 rounded-xl p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Tu reserva"}),e.jsx("div",{className:"font-bold",children:l.toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long"})})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"text-2xl font-black text-green-400",children:n})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-gray-400 uppercase font-bold block mb-1",children:[e.jsx(E,{size:14,className:"inline mr-1"})," Nombre Completo *"]}),e.jsx("input",{type:"text",required:!0,value:a.customer_name,onChange:s=>i({...a,customer_name:s.target.value}),className:"w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 text-white focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"Tu nombre"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-gray-400 uppercase font-bold block mb-1",children:[e.jsx(I,{size:14,className:"inline mr-1"})," Jugadores"]}),e.jsx("input",{type:"number",min:1,max:10,value:a.num_players,onChange:s=>i({...a,num_players:parseInt(s.target.value)||1}),className:"w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 text-white focus:ring-2 focus:ring-blue-500 outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-gray-400 uppercase font-bold block mb-1",children:[e.jsx(O,{size:14,className:"inline mr-1"})," Duración"]}),e.jsx("select",{value:a.duration_minutes,onChange:s=>i({...a,duration_minutes:parseInt(s.target.value)}),className:"w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 text-white focus:ring-2 focus:ring-blue-500 outline-none",children:M.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-gray-400 uppercase font-bold block mb-1",children:[e.jsx(F,{size:14,className:"inline mr-1"})," Teléfono"]}),e.jsx("input",{type:"tel",value:a.customer_phone,onChange:s=>i({...a,customer_phone:s.target.value}),className:"w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 text-white focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"600 123 456"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-gray-400 uppercase font-bold block mb-1",children:[e.jsx(q,{size:14,className:"inline mr-1"})," Email"]}),e.jsx("input",{type:"email",value:a.customer_email,onChange:s=>i({...a,customer_email:s.target.value}),className:"w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 text-white focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"tu@email.com"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-400 uppercase font-bold block mb-1",children:"Notas (opcional)"}),e.jsx("textarea",{value:a.notes,onChange:s=>i({...a,notes:s.target.value}),className:"w-full bg-gray-800 border border-gray-700 rounded-xl px-4 py-3 text-white focus:ring-2 focus:ring-blue-500 outline-none resize-none",rows:2,placeholder:"Cumpleaños, evento especial..."})]})]}),o.isError&&e.jsxs("div",{className:"bg-red-900/30 border border-red-500/50 rounded-xl p-3 text-red-400 text-sm",children:[e.jsx(v,{size:16,className:"inline mr-2"}),o.error?.message||"Error al crear la reserva"]}),e.jsxs("button",{onClick:z,disabled:!a.customer_name||o.isPending,className:"w-full py-4 bg-green-600 hover:bg-green-500 disabled:bg-gray-800 disabled:text-gray-600 rounded-xl font-bold uppercase tracking-wide transition-all flex items-center justify-center gap-2",children:[o.isPending?e.jsx(w,{className:"animate-spin",size:20}):e.jsx(N,{size:20}),"Confirmar Reserva"]})]})]}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-gray-900 border-t border-gray-800 p-4 text-center text-xs text-gray-600",children:[e.jsx(A,{size:12,className:"inline mr-1"}),u," · Sistema de Reservas Online"]})]})}export{Y as default};
