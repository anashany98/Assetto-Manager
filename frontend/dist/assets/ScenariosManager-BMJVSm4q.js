import{d as R,r as b,u as h,j as e}from"./index-MjGtIaAt.js";import{u as p}from"./useMutation-Ckz2NycH.js";import{c as T,u as A,d as q,g as z,a as M,b as P}from"./content-JD-QJUlN.js";import{P as j}from"./plus-Dqq5J1Gg.js";import{S as N}from"./square-pen-DnrhdgAf.js";import{X as F}from"./x-CyrpJdpA.js";import{C as v}from"./car-Bto1fEN0.js";import{C as w}from"./check-DDMqjJty.js";import{F as C}from"./flag-Cs2ejYuM.js";import{S as K}from"./save-Cgmpexpf.js";import{C as Q}from"./clock-DpL4IKBu.js";import{T as $}from"./trash-2-Kfiypbhy.js";function re(){const o=R(),[c,x]=b.useState(null),[n,i]=b.useState(!1),[s,l]=b.useState({name:"",description:"",allowed_cars:[],allowed_tracks:[],allowed_durations:[10,15,20],is_active:!0}),{data:f=[],isLoading:S}=h({queryKey:["scenarios"],queryFn:z}),{data:_=[]}=h({queryKey:["cars",1],queryFn:()=>M(1)}),{data:k=[]}=h({queryKey:["tracks",1],queryFn:()=>P(1)}),g=p({mutationFn:T,onSuccess:()=>{o.invalidateQueries({queryKey:["scenarios"]}),i(!1),m()}}),u=p({mutationFn:r=>A(r.id,r.scenario),onMutate:async r=>{await o.cancelQueries({queryKey:["scenarios"]});const a=o.getQueryData(["scenarios"]);return o.setQueryData(["scenarios"],(t=[])=>t.map(d=>d.id===r.id?{...d,...r.scenario}:d)),{previousScenarios:a}},onError:(r,a,t)=>{o.setQueryData(["scenarios"],t?.previousScenarios)},onSettled:()=>{o.invalidateQueries({queryKey:["scenarios"]}),x(null),m()}}),E=p({mutationFn:q,onSuccess:()=>o.invalidateQueries({queryKey:["scenarios"]})}),m=()=>{l({name:"",description:"",allowed_cars:[],allowed_tracks:[],allowed_durations:[10,15,20],is_active:!0})},I=r=>{x(r.id),l({...r}),i(!1)},O=()=>{if(!s.name)return alert("El nombre es obligatorio");n?g.mutate(s):c&&u.mutate({id:c,scenario:s})},y=(r,a)=>r.includes(a)?r.filter(t=>t!==a):[...r,a],D=r=>{const a=s.allowed_durations||[];return a.includes(r)?a.filter(t=>t!==r):[...a,r].sort((t,d)=>t-d)};return e.jsxs("div",{className:"p-8 text-white h-full flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-black italic",children:"GESTOR DE ESCENARIOS"}),e.jsx("p",{className:"text-gray-400",children:"Configura eventos y contenido restringido para el Kiosko"})]}),!n&&!c&&e.jsxs("button",{onClick:()=>{i(!0),m()},className:"bg-blue-600 hover:bg-blue-500 text-white px-6 py-3 rounded-xl font-bold flex items-center gap-2 transition-all",children:[e.jsx(j,{size:20})," NUEVO ESCENARIO"]})]}),(n||c)&&e.jsxs("div",{className:"bg-gray-800 rounded-2xl p-6 mb-8 border border-gray-700 animate-in slide-in-from-top-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[n?e.jsx(j,{className:"text-blue-500"}):e.jsx(N,{className:"text-yellow-500"}),n?"CREAR NUEVO ESCENARIO":"EDITAR ESCENARIO"]}),e.jsx("button",{onClick:()=>{i(!1),x(null)},className:"text-gray-400 hover:text-white",children:e.jsx(F,{})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"space-y-6 lg:col-span-1",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-400 text-sm font-bold mb-1",children:"NOMBRE"}),e.jsx("input",{type:"text",value:s.name||"",onChange:r=>l({...s,name:r.target.value}),className:"w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-3 text-white focus:border-blue-500 outline-none",placeholder:"Ej. Torneo Drift JDM"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-400 text-sm font-bold mb-1",children:"DESCRIPCIÓN"}),e.jsx("textarea",{value:s.description||"",onChange:r=>l({...s,description:r.target.value}),className:"w-full bg-gray-900 border border-gray-700 rounded-lg px-4 py-3 text-white focus:border-blue-500 outline-none h-32 resize-none",placeholder:"Descripción breve para el usuario..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-400 text-sm font-bold mb-1",children:"OPCIONES DE TIEMPO (Minutos)"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[5,10,15,20,30,45,60].map(r=>e.jsxs("button",{onClick:()=>l({...s,allowed_durations:D(r)}),className:`px-3 py-2 rounded-lg text-sm font-bold border transition-all ${s.allowed_durations?.includes(r)?"bg-blue-600 border-blue-500 text-white":"bg-gray-900 border-gray-700 text-gray-400 hover:border-gray-500"}`,children:[r,"m"]},r))})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-3 p-3 bg-gray-900 border border-gray-700 rounded-lg cursor-pointer hover:border-blue-500 transition-colors",children:[e.jsx("div",{className:`w-10 h-6 rounded-full p-1 transition-colors ${s.is_active?"bg-green-500":"bg-gray-700"}`,children:e.jsx("div",{className:`w-4 h-4 bg-white rounded-full transition-transform ${s.is_active?"translate-x-4":"translate-x-0"}`})}),e.jsx("span",{className:"font-bold text-sm text-gray-300",children:"ESCENARIO ACTIVO"}),e.jsx("input",{type:"checkbox",className:"hidden",checked:s.is_active||!1,onChange:r=>l({...s,is_active:r.target.checked})})]})})]}),e.jsxs("div",{className:"flex flex-col h-[500px] bg-gray-900/50 rounded-xl p-4 border border-gray-700 lg:col-span-1",children:[e.jsxs("h3",{className:"text-sm font-bold text-gray-400 mb-3 flex items-center gap-2",children:[e.jsx(v,{size:16})," COCHES PERMITIDOS"]}),e.jsx("div",{className:"flex-1 overflow-y-auto space-y-1 custom-scrollbar pr-2",children:_.map(r=>e.jsxs("div",{onClick:()=>l({...s,allowed_cars:y(s.allowed_cars||[],r.id)}),className:`p-3 rounded-lg cursor-pointer text-sm flex items-center gap-3 transition-colors ${s.allowed_cars?.includes(r.id)?"bg-blue-600/20 text-blue-400 border border-blue-600/30":"text-gray-400 hover:bg-gray-800 border border-transparent"}`,children:[e.jsx("div",{className:`w-5 h-5 rounded border flex items-center justify-center transition-colors ${s.allowed_cars?.includes(r.id)?"bg-blue-600 border-blue-600":"border-gray-600"}`,children:s.allowed_cars?.includes(r.id)&&e.jsx(w,{size:14,className:"text-white"})}),e.jsx("span",{className:"truncate font-medium",children:r.name})]},r.id))}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-700 text-xs text-center text-gray-500 font-bold uppercase",children:[s.allowed_cars?.length||0," coches seleccionados (0 = Todos)"]})]}),e.jsxs("div",{className:"flex flex-col h-[500px] bg-gray-900/50 rounded-xl p-4 border border-gray-700 lg:col-span-1",children:[e.jsxs("h3",{className:"text-sm font-bold text-gray-400 mb-3 flex items-center gap-2",children:[e.jsx(C,{size:16})," CIRCUITOS PERMITIDOS"]}),e.jsx("div",{className:"flex-1 overflow-y-auto space-y-1 custom-scrollbar pr-2",children:k.map(r=>e.jsxs("div",{onClick:()=>l({...s,allowed_tracks:y(s.allowed_tracks||[],r.id)}),className:`p-3 rounded-lg cursor-pointer text-sm flex items-center gap-3 transition-colors ${s.allowed_tracks?.includes(r.id)?"bg-green-600/20 text-green-400 border border-green-600/30":"text-gray-400 hover:bg-gray-800 border border-transparent"}`,children:[e.jsx("div",{className:`w-5 h-5 rounded border flex items-center justify-center transition-colors ${s.allowed_tracks?.includes(r.id)?"bg-green-600 border-green-600":"border-gray-600"}`,children:s.allowed_tracks?.includes(r.id)&&e.jsx(w,{size:14,className:"text-white"})}),e.jsx("span",{className:"truncate font-medium",children:r.name})]},r.id))}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-700 text-xs text-center text-gray-500 font-bold uppercase",children:[s.allowed_tracks?.length||0," circuitos seleccionados (0 = Todos)"]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 border-t border-gray-700 pt-6",children:[e.jsx("button",{onClick:()=>{i(!1),x(null)},className:"text-gray-400 hover:text-white font-bold px-6 py-3",children:"CANCELAR"}),e.jsxs("button",{onClick:O,disabled:g.isPending||u.isPending,className:"bg-green-600 hover:bg-green-500 text-white font-bold px-8 py-3 rounded-xl flex items-center gap-2 shadow-lg shadow-green-600/20",children:[e.jsx(K,{size:20})," ",g.isPending||u.isPending?"GUARDANDO...":"GUARDAR ESCENARIO"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:S?e.jsx("p",{className:"text-gray-500",children:"Cargando escenarios..."}):f.length===0?e.jsxs("div",{className:"col-span-full text-center py-20 text-gray-600 border-2 border-dashed border-gray-800 rounded-3xl",children:[e.jsx("p",{className:"text-xl font-bold",children:"No hay escenarios creados"}),e.jsx("p",{className:"text-sm",children:"Crea uno para empezar a personalizar el Kiosko"})]}):f.map(r=>e.jsxs("div",{className:"bg-gray-800 rounded-2xl p-6 border border-gray-700 hover:border-blue-500 transition-all group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h3",{className:"text-xl font-black text-white",children:r.name}),e.jsx("button",{onClick:a=>{a.stopPropagation(),u.mutate({id:r.id,scenario:{is_active:!r.is_active}})},className:`text-xs font-bold px-3 py-1 rounded transition-colors ${r.is_active?"bg-green-500/20 text-green-400 hover:bg-green-500/30":"bg-gray-700 text-gray-500 hover:bg-gray-600"}`,children:r.is_active?"ACTIVO":"INACTIVO"})]}),e.jsx("p",{className:"text-gray-400 text-sm mb-6 line-clamp-2 h-10",children:r.description||"Sin descripción"}),e.jsxs("div",{className:"space-y-2 mb-6 text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{size:16}),e.jsx("span",{className:"font-bold text-gray-300",children:r.allowed_cars?.length?r.allowed_cars.length:"TODOS"})," Coches"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{size:16}),e.jsx("span",{className:"font-bold text-gray-300",children:r.allowed_tracks?.length?r.allowed_tracks.length:"TODOS"})," Circuitos"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{size:16}),e.jsx("span",{className:"font-bold text-gray-300",children:r.allowed_durations?.join(", ")||"Default"})," Min"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>I(r),className:"flex-1 bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 rounded-lg flex items-center justify-center gap-2",children:[e.jsx(N,{size:16})," EDITAR"]}),e.jsx("button",{onClick:()=>{confirm("¿Seguro que quieres eliminar este escenario?")&&E.mutate(r.id)},className:"px-4 bg-red-900/30 hover:bg-red-600 text-red-500 hover:text-white rounded-lg transition-colors border border-red-900/50",children:e.jsx($,{size:18})})]})]},r.id))})]})}export{re as default};
