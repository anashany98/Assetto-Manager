import{c as Z,r as p,R as Q,u as K,j as e,a as M,A as W}from"./index-MjGtIaAt.js";import{L as J}from"./loader-circle-DSpMC2cv.js";import{T as B}from"./trending-up-BHF8h5rZ.js";import{G as ee}from"./gauge-BmF6m-rA.js";import{A as te}from"./activity-d8XIJMYL.js";import{r as re,D as ae,u as se,a as ne,b as ie,c as oe,d as le,e as D,s as de,f as ce,g as G,h as me,i as xe,j as fe,Z as ue,L as ye,C as pe,k as he,l as O,m as _,n as U,o as ge,R as C,X as L}from"./CartesianChart-byA6CRUy.js";import{L as R,a as g}from"./LineChart-BAS0o-Op.js";import{C as I}from"./getRadiusAndStrokeWidthFromDot-hhzSCn0X.js";import{Y as N}from"./YAxis-hjvaWDO6.js";import{T}from"./Tooltip-BKNbpHsn.js";import{L as E}from"./Legend-DL5FTiQX.js";import{A as V,a as je}from"./AreaChart-B6ltY9AV.js";import{T as be}from"./timer-CamBLO3n.js";import{c as ve}from"./clsx-B-dksMZM.js";const ke=[["path",{d:"M5 12h14",key:"1ays0h"}]],Se=Z("minus",ke);const Ne=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],q=Z("trending-down",Ne);function X(a,r){var s=Object.keys(a);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(a);r&&(n=n.filter(function(c){return Object.getOwnPropertyDescriptor(a,c).enumerable})),s.push.apply(s,n)}return s}function Y(a){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?X(Object(s),!0).forEach(function(n){Ae(a,n,s[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(s)):X(Object(s)).forEach(function(n){Object.defineProperty(a,n,Object.getOwnPropertyDescriptor(s,n))})}return a}function Ae(a,r,s){return(r=we(r))in a?Object.defineProperty(a,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):a[r]=s,a}function we(a){var r=Pe(a,"string");return typeof r=="symbol"?r:r+""}function Pe(a,r){if(typeof a!="object"||!a)return a;var s=a[Symbol.toPrimitive];if(s!==void 0){var n=s.call(a,r);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(a)}function z(){return z=Object.assign?Object.assign.bind():function(a){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var n in s)({}).hasOwnProperty.call(s,n)&&(a[n]=s[n])}return a},z.apply(null,arguments)}var Fe=(a,r)=>{var s;if(p.isValidElement(a))s=p.cloneElement(a,r);else if(typeof a=="function")s=a(r);else{if(!O(r.x1)||!O(r.y1)||!O(r.x2)||!O(r.y2))return null;s=p.createElement("line",z({},r,{className:"recharts-reference-line-line"}))}return s},De=(a,r,s,n,c,y)=>{var{x:o,width:h}=y,m=c.y.apply(a,{position:s});if(U(m)||r==="discard"&&!c.y.isInRange(m))return null;var i=[{x:o+h,y:m},{x:o,y:m}];return n==="left"?i.reverse():i},Oe=(a,r,s,n,c,y)=>{var{y:o,height:h}=y,m=c.x.apply(a,{position:s});if(U(m)||r==="discard"&&!c.x.isInRange(m))return null;var i=[{x:m,y:o+h},{x:m,y:o}];return n==="top"?i.reverse():i},Ce=(a,r,s,n)=>{var c=a.map(y=>n.apply(y,{position:s}));return r==="discard"&&c.some(y=>!n.isInRange(y))?null:c},Le=(a,r,s,n,c,y)=>{var{x:o,y:h,segment:m,ifOverflow:i}=y,v=_(o),k=_(h);return k?De(h,i,s,c,a,r):v?Oe(o,i,s,n,a,r):m!=null&&m.length===2?Ce(m,i,s,a):null};function Ie(a){var r=se();return p.useEffect(()=>(r(ne(a)),()=>{r(ie(a))})),null}function Te(a){var{xAxisId:r,yAxisId:s,shape:n,className:c,ifOverflow:y}=a,o=oe(),h=le(),m=D(u=>de(u,r)),i=D(u=>ce(u,s)),v=D(u=>G(u,"xAxis",r,o)),k=D(u=>G(u,"yAxis",s,o)),w=me();if(!h||!w||m==null||i==null||v==null||k==null)return null;var S=xe({x:v,y:k}),j=Le(S,w,a.position,m.orientation,i.orientation,a);if(!j)return null;var[{x:P,y:F},{x:t,y:l}]=j,x=y==="hidden"?"url(#".concat(h,")"):void 0,d=Y(Y({clipPath:x},fe(a)),{},{x1:P,y1:F,x2:t,y2:l}),f=ge({x1:P,y1:F,x2:t,y2:l});return p.createElement(ue,{zIndex:a.zIndex},p.createElement(ye,{className:ve("recharts-reference-line",c)},Fe(n,d),p.createElement(pe,z({},f,{lowerWidth:f.width,upperWidth:f.width}),p.createElement(he,{label:a.label}),a.children)))}var $e={ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle",zIndex:ae.line};function H(a){var r=re(a,$e);return p.createElement(p.Fragment,null,p.createElement(Ie,{yAxisId:r.yAxisId,xAxisId:r.xAxisId,ifOverflow:r.ifOverflow,x:r.x,y:r.y,segment:r.segment}),p.createElement(Te,r))}H.displayName="ReferenceLine";const $=[{id:1,start:0,end:.33,name:"S1",color:"#ef4444"},{id:2,start:.33,end:.66,name:"S2",color:"#eab308"},{id:3,start:.66,end:1,name:"S3",color:"#22c55e"}];function Ue({lapId:a,compareLapId:r}){const[s,n]=Q.useState("engine"),{data:c,isLoading:y}=K({queryKey:["telemetry",a],queryFn:async()=>{try{return(await M.get(`${W}/telemetry/lap/${a}/telemetry`)).data}catch(t){throw console.error(`Error fetching telemetry for lap ${a}:`,t?.response?.status,t?.response?.data),t}},enabled:!!a,retry:!1}),{data:o,isLoading:h}=K({queryKey:["telemetry",r],queryFn:async()=>r?(await M.get(`${W}/telemetry/lap/${r}/telemetry`)).data:null,enabled:!!r});if(y||h)return e.jsxs("div",{className:"h-64 flex flex-col items-center justify-center text-gray-500",children:[e.jsx(J,{className:"animate-spin mb-2"}),e.jsx("span",{className:"text-xs uppercase font-bold tracking-widest",children:"Cargando Telemetría..."})]});if(!c||c.length===0)return e.jsxs("div",{className:"h-64 flex flex-col items-center justify-center text-gray-500",children:[e.jsx("p",{className:"text-xs uppercase font-bold tracking-widest",children:"Sin datos de telemetría disponibles"}),e.jsx("p",{className:"text-[10px] mt-2",children:"La telemetría solo está disponible para vueltas recientes."})]});const m=200,i=Array.from({length:m},(t,l)=>{const x=l/m,d=c.reduce((b,A)=>Math.abs(A.n-x)<Math.abs(b.n-x)?A:b),f=o?o.reduce((b,A)=>Math.abs(A.n-x)<Math.abs(b.n-x)?A:b):null,u=f?d.t-f.t:0;return{dist:Math.round(x*100),pos:x,speed:d.s,rpm:d.r,gear:d.g,time:d.t,gas:d.gas||0,brk:d.brk||0,str:d.str||0,gl:d.gl||0,gn:d.gn||0,tt:d.tt||0,compareSpeed:f?.s??null,compareTime:f?.t??null,compareGas:f?.gas??null,compareBrk:f?.brk??null,delta:u,deltaSeconds:u/1e3}}),v=(t,l)=>{const x=t.filter(u=>u.n>=l.start&&u.n<l.end);if(x.length<2)return null;const d=x[0].t;return x[x.length-1].t-d},k=$.map(t=>v(c,t)),w=o?$.map(t=>v(o,t)):null,S=i.length>0?i[i.length-1].delta:0,j=S<0?"faster":S>0?"slower":"same",P=t=>{if(t===null)return"--:--.---";const l=Math.floor(t/1e3),x=t%1e3;return`${l}.${x.toString().padStart(3,"0")}`},F=[{id:"engine",label:"Motor"},{id:"inputs",label:"Pedales"},{id:"physics",label:"Físicas"},{id:"delta",label:"Delta"},{id:"sectors",label:"Sectores"}];return e.jsxs("div",{className:"w-full flex flex-col",children:[o&&e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[e.jsxs("div",{className:"bg-gray-800 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-[10px] text-gray-500 uppercase font-bold",children:"Delta Total"}),e.jsxs("div",{className:`text-xl font-black font-mono ${j==="faster"?"text-green-500":j==="slower"?"text-red-500":"text-gray-400"}`,children:[j==="faster"&&e.jsx(q,{className:"inline w-4 h-4 mr-1"}),j==="slower"&&e.jsx(B,{className:"inline w-4 h-4 mr-1"}),j==="same"&&e.jsx(Se,{className:"inline w-4 h-4 mr-1"}),S>=0?"+":"",(S/1e3).toFixed(3),"s"]})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-[10px] text-gray-500 uppercase font-bold",children:"Vel. Máx"}),e.jsxs("div",{className:"text-xl font-black text-yellow-500 font-mono",children:[e.jsx(ee,{className:"inline w-4 h-4 mr-1"}),Math.max(...i.map(t=>t.speed))," km/h"]})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-[10px] text-gray-500 uppercase font-bold",children:"Puntos"}),e.jsxs("div",{className:"text-xl font-black text-blue-500 font-mono",children:[e.jsx(te,{className:"inline w-4 h-4 mr-1"}),i.length]})]})]}),e.jsx("div",{className:"flex space-x-1 bg-gray-900 p-1 rounded-t-xl mb-1",children:F.map(t=>e.jsx("button",{onClick:()=>n(t.id),className:`flex-1 py-1.5 text-[10px] uppercase font-bold rounded transition-all ${s===t.id?"bg-blue-600 text-white":"text-gray-500 hover:text-gray-300 hover:bg-gray-800"}`,children:t.label},t.id))}),e.jsxs("div",{className:"h-72 bg-gray-900/50 rounded-b-xl p-2 border border-white/5 relative",children:[s==="engine"&&e.jsx(C,{width:"100%",height:"100%",children:e.jsxs(R,{data:i,children:[e.jsx(I,{strokeDasharray:"3 3",stroke:"#374151",opacity:.5}),e.jsx(L,{dataKey:"dist",tickFormatter:t=>`${t}%`,stroke:"#6B7280",fontSize:10}),e.jsx(N,{yAxisId:"left",stroke:"#9CA3AF",fontSize:10,domain:[0,"auto"],tickFormatter:t=>`${t}`}),e.jsx(N,{yAxisId:"right",orientation:"right",stroke:"#6B7280",fontSize:10,domain:[0,9e3],hide:!0}),e.jsx(T,{contentStyle:{backgroundColor:"#111827",border:"1px solid #374151",borderRadius:"8px",fontSize:"12px"},itemStyle:{color:"#F3F4F6"},labelFormatter:t=>`Posición: ${t}%`,formatter:(t,l)=>l==="Velocidad"||l==="Rival"?[`${Math.round(Number(t))} km/h`,l]:l==="RPM"?[Math.round(Number(t)),l]:l==="Marcha"?[`G${t}`,l]:[String(t),l]}),e.jsx(E,{iconSize:8,wrapperStyle:{fontSize:"10px"}}),e.jsx(V,{yAxisId:"left",type:"stepAfter",dataKey:"gear",stroke:"none",fill:"#374151",fillOpacity:.2,name:"Marcha"}),e.jsx(g,{yAxisId:"left",type:"monotone",dataKey:"speed",stroke:"#EAB308",strokeWidth:2,dot:!1,name:"Velocidad",animationDuration:500}),e.jsx(g,{yAxisId:"right",type:"monotone",dataKey:"rpm",stroke:"#ef4444",strokeWidth:1,dot:!1,strokeOpacity:.5,name:"RPM",animationDuration:500}),o&&e.jsx(g,{yAxisId:"left",type:"monotone",dataKey:"compareSpeed",stroke:"#3B82F6",strokeWidth:2,dot:!1,strokeDasharray:"5 5",name:"Rival",animationDuration:500})]})}),s==="inputs"&&e.jsx(C,{width:"100%",height:"100%",children:e.jsxs(R,{data:i,children:[e.jsx(I,{strokeDasharray:"3 3",stroke:"#374151",opacity:.5}),e.jsx(L,{dataKey:"dist",tickFormatter:t=>`${t}%`,stroke:"#6B7280",fontSize:10}),e.jsx(N,{stroke:"#9CA3AF",fontSize:10,domain:[0,1],tickFormatter:t=>`${Math.round(t*100)}%`}),e.jsx(T,{contentStyle:{backgroundColor:"#111827",border:"1px solid #374151",borderRadius:"8px",fontSize:"12px"},itemStyle:{color:"#F3F4F6"},labelFormatter:t=>`Posición: ${t}%`}),e.jsx(E,{iconSize:8,wrapperStyle:{fontSize:"10px"}}),e.jsx(g,{type:"monotone",dataKey:"gas",stroke:"#22c55e",strokeWidth:2,dot:!1,name:"Acelerador",animationDuration:500}),e.jsx(g,{type:"monotone",dataKey:"brk",stroke:"#ef4444",strokeWidth:2,dot:!1,name:"Freno",animationDuration:500}),o&&e.jsxs(e.Fragment,{children:[e.jsx(g,{type:"monotone",dataKey:"compareGas",stroke:"#22c55e",strokeWidth:1,dot:!1,strokeOpacity:.4,strokeDasharray:"3 3",name:"Ace. Rival",animationDuration:500}),e.jsx(g,{type:"monotone",dataKey:"compareBrk",stroke:"#ef4444",strokeWidth:1,dot:!1,strokeOpacity:.4,strokeDasharray:"3 3",name:"Fre. Rival",animationDuration:500})]}),e.jsx(g,{type:"monotone",dataKey:"str",stroke:"#3b82f6",strokeWidth:1,dot:!1,strokeDasharray:"3 3",name:"Volante",animationDuration:500})]})}),s==="physics"&&e.jsx(C,{width:"100%",height:"100%",children:e.jsxs(R,{data:i,children:[e.jsx(I,{strokeDasharray:"3 3",stroke:"#374151",opacity:.5}),e.jsx(L,{dataKey:"dist",tickFormatter:t=>`${t}%`,stroke:"#6B7280",fontSize:10}),e.jsx(N,{yAxisId:"g",stroke:"#9CA3AF",fontSize:10,domain:[-3,3],label:{value:"G-Force",angle:-90,position:"insideLeft",fill:"#6B7280",fontSize:10}}),e.jsx(N,{yAxisId:"temp",orientation:"right",stroke:"#f97316",fontSize:10,domain:[20,150],hide:!0}),e.jsx(T,{contentStyle:{backgroundColor:"#111827",border:"1px solid #374151",borderRadius:"8px",fontSize:"12px"},itemStyle:{color:"#F3F4F6"},labelFormatter:t=>`Posición: ${t}%`}),e.jsx(E,{iconSize:8,wrapperStyle:{fontSize:"10px"}}),e.jsx(g,{yAxisId:"g",type:"monotone",dataKey:"gl",stroke:"#f472b6",strokeWidth:2,dot:!1,name:"G-Lateral",animationDuration:500}),e.jsx(g,{yAxisId:"g",type:"monotone",dataKey:"gn",stroke:"#a78bfa",strokeWidth:2,dot:!1,name:"G-Long",animationDuration:500}),e.jsx(g,{yAxisId:"temp",type:"monotone",dataKey:"tt",stroke:"#f97316",strokeWidth:2,dot:!1,strokeDasharray:"2 2",name:"Temp. Goma",animationDuration:500})]})}),s==="delta"&&e.jsx(e.Fragment,{children:o?e.jsx(C,{width:"100%",height:"100%",children:e.jsxs(je,{data:i,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"deltaPositive",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#ef4444",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#ef4444",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"deltaNegative",x1:"0",y1:"1",x2:"0",y2:"0",children:[e.jsx("stop",{offset:"5%",stopColor:"#22c55e",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#22c55e",stopOpacity:0})]})]}),e.jsx(I,{strokeDasharray:"3 3",stroke:"#374151",opacity:.5}),e.jsx(L,{dataKey:"dist",tickFormatter:t=>`${t}%`,stroke:"#6B7280",fontSize:10}),e.jsx(N,{stroke:"#9CA3AF",fontSize:10,domain:["auto","auto"],tickFormatter:t=>`${t>=0?"+":""}${t.toFixed(1)}s`}),e.jsx(H,{y:0,stroke:"#6B7280",strokeDasharray:"3 3"}),e.jsx(T,{contentStyle:{backgroundColor:"#111827",border:"1px solid #374151",borderRadius:"8px",fontSize:"12px"},itemStyle:{color:"#F3F4F6"},labelFormatter:t=>`Posición: ${t}%`,formatter:t=>[`${Number(t??0)>=0?"+":""}${Number(t??0).toFixed(3)}s`,"Delta"]}),e.jsx(V,{type:"monotone",dataKey:"deltaSeconds",stroke:"#6b7280",fill:"url(#deltaPositive)",strokeWidth:2,animationDuration:500,name:"Delta"})]})}):e.jsx("div",{className:"h-full flex items-center justify-center text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx(be,{size:32,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-xs uppercase font-bold",children:"Selecciona una vuelta rival"}),e.jsx("p",{className:"text-[10px] mt-1",children:"Para ver el delta de tiempo"})]})})}),s==="sectors"&&e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"grid grid-cols-3 gap-3 flex-1",children:$.map((t,l)=>{const x=k[l],d=w?.[l],f=x&&d?x-d:null,u=f!==null&&f<0,b=f!==null&&f>0;return e.jsxs("div",{className:"bg-gray-800 rounded-xl p-4 flex flex-col items-center justify-center border-t-4",style:{borderColor:t.color},children:[e.jsx("div",{className:"text-2xl font-black text-white mb-1",children:t.name}),e.jsx("div",{className:"text-xl font-mono font-bold text-gray-200",children:P(x)}),d&&e.jsxs("div",{className:`text-sm font-mono font-bold mt-2 ${u?"text-green-500":b?"text-red-500":"text-gray-500"}`,children:[u&&e.jsx(q,{className:"inline w-3 h-3 mr-1"}),b&&e.jsx(B,{className:"inline w-3 h-3 mr-1"}),f!==null&&(f>=0?"+":""),(f/1e3).toFixed(3),"s"]}),!d&&o&&e.jsx("div",{className:"text-[10px] text-gray-600 mt-2",children:"Sin datos rival"})]},t.id)})}),e.jsx("div",{className:"mt-4 h-8 flex rounded-lg overflow-hidden",children:$.map(t=>e.jsx("div",{className:"flex-1 flex items-center justify-center text-xs font-bold text-white/80",style:{backgroundColor:t.color},children:t.name},t.id))})]})]})]})}export{Ue as T};
