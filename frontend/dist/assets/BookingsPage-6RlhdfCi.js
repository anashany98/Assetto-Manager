import{d as A,r as d,u as k,j as e,C,i as U,k as Q,b as _,U as D,a as u,A as g}from"./index-MjGtIaAt.js";import{u as z}from"./useMutation-Ckz2NycH.js";import{c as i}from"./utils-BykweIWy.js";import{L as T}from"./loader-circle-DSpMC2cv.js";import{X as x}from"./x-CyrpJdpA.js";import{P as L,M as E}from"./phone-C4d7JN57.js";import{C as I}from"./check-DDMqjJty.js";import{C as $}from"./circle-check-big-D_wv1sd6.js";import{C as K}from"./clock-DpL4IKBu.js";import{T as M}from"./timer-CamBLO3n.js";import"./clsx-B-dksMZM.js";const p={pending:"bg-yellow-500",confirmed:"bg-green-500",cancelled:"bg-red-500",completed:"bg-blue-500"},O={pending:"Pendiente",confirmed:"Confirmada",cancelled:"Cancelada",completed:"Completada"};function re(){const f=A(),[l,N]=d.useState(new Date),[v,b]=d.useState(!1),[t,o]=d.useState(null),[m,w]=d.useState(null),[r,n]=d.useState({customer_name:"",customer_email:"",customer_phone:"",num_players:1,duration_minutes:60,notes:""}),c=(s=>{const a=new Date(s),y=a.getDay(),P=a.getDate()-y+(y===0?-6:1);return new Date(a.setDate(P))})(l),{data:R,isLoading:q}=k({queryKey:["bookings-week",c.toISOString().split("T")[0]],queryFn:async()=>(await u.get(`${g}/bookings/calendar/week`,{params:{start_date:c.toISOString().split("T")[0]}})).data}),{data:B}=k({queryKey:["slots-availability",l.toISOString().split("T")[0]],queryFn:async()=>(await u.get(`${g}/bookings/available`,{params:{target_date:l.toISOString().split("T")[0]}})).data,enabled:v}),h=z({mutationFn:async s=>(await u.post(`${g}/bookings/`,s)).data,onSuccess:()=>{f.invalidateQueries({queryKey:["bookings-week"]}),b(!1),w(null),n({customer_name:"",customer_email:"",customer_phone:"",num_players:1,duration_minutes:60,notes:""})}}),j=z({mutationFn:async({id:s,status:a})=>(await u.put(`${g}/bookings/${s}/status`,{status:a})).data,onSuccess:()=>{f.invalidateQueries({queryKey:["bookings-week"]})}}),S=s=>{const a=new Date(l);a.setDate(a.getDate()+(s==="next"?7:-7)),N(a)},F=s=>{s.preventDefault(),!(!m||!r.customer_name)&&h.mutate({...r,date:l.toISOString().split("T")[0],time_slot:m})};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-black text-white uppercase tracking-tight",children:"Reservas"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Gestiona las reservas de simuladores"})]}),e.jsxs("button",{onClick:()=>b(!0),className:"px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-lg transition-colors flex items-center gap-2",children:[e.jsx(C,{size:18}),"Nueva Reserva"]})]}),e.jsxs("div",{className:"flex items-center justify-between bg-gray-800 p-4 rounded-xl",children:[e.jsx("button",{onClick:()=>S("prev"),className:"p-2 hover:bg-gray-700 rounded-lg transition-colors",children:e.jsx(U,{size:20,className:"text-gray-400"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-lg font-bold text-white",children:c.toLocaleDateString("es-ES",{month:"long",year:"numeric"})}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Semana del ",c.toLocaleDateString("es-ES",{day:"numeric"})," al"," ",new Date(c.getTime()+8640*60*1e3).toLocaleDateString("es-ES",{day:"numeric",month:"short"})]})]}),e.jsx("button",{onClick:()=>S("next"),className:"p-2 hover:bg-gray-700 rounded-lg transition-colors",children:e.jsx(Q,{size:20,className:"text-gray-400"})})]}),q?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(T,{"data-testid":"bookings-loader",className:"animate-spin text-blue-500",size:32})}):e.jsx("div",{className:"grid grid-cols-7 gap-3",children:R?.days?.map(s=>e.jsxs("div",{className:i("bg-gray-800 rounded-xl p-3 min-h-[200px]",s.date===new Date().toISOString().split("T")[0]&&"ring-2 ring-blue-500"),children:[e.jsxs("div",{className:"text-center mb-3 pb-2 border-b border-gray-700",children:[e.jsx("div",{className:"text-[10px] text-gray-500 uppercase font-bold",children:new Date(s.date).toLocaleDateString("es-ES",{weekday:"short"})}),e.jsx("div",{className:"text-xl font-black text-white",children:new Date(s.date).getDate()})]}),e.jsxs("div",{className:"space-y-1.5",children:[s.bookings?.map(a=>e.jsxs("div",{onClick:()=>o(a),className:i("p-2 rounded-lg text-xs cursor-pointer transition-all hover:scale-105 border",p[a.status]+"/20 border-"+p[a.status].replace("bg-","")+"/50",a.status==="cancelled"&&"opacity-60 grayscale-[0.5]"),children:[e.jsxs("div",{className:"font-bold text-white truncate flex items-center justify-between",children:[a.time_slot,a.status==="cancelled"&&e.jsx(x,{size:12,className:"text-red-500"})]}),e.jsx("div",{className:i("truncate",a.status==="cancelled"?"text-gray-500 line-through":"text-gray-400"),children:a.customer_name}),e.jsx("div",{className:"flex items-center justify-between mt-1",children:e.jsx("span",{className:i("text-[9px] font-bold uppercase px-1.5 py-0.5 rounded",p[a.status]),children:O[a.status]})})]},a.id)),(!s.bookings||s.bookings.length===0)&&e.jsx("div",{className:"text-center text-gray-600 text-xs py-4",children:"Sin reservas"})]})]},s.date))}),t&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4 animate-in fade-in",children:e.jsxs("div",{className:"bg-gray-900 rounded-2xl p-6 w-full max-w-md border border-gray-700 shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 pb-4 border-b border-gray-800",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-black text-white uppercase tracking-tight",children:"Detalles Reserva"}),e.jsxs("p",{className:"text-xs text-gray-500 font-bold uppercase",children:[t.time_slot," - ",new Date(t.date).toLocaleDateString()]})]}),e.jsx("button",{onClick:()=>o(null),className:"p-2 hover:bg-gray-800 rounded-lg",children:e.jsx(x,{size:20,className:"text-gray-400"})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center bg-gray-800 p-4 rounded-xl",children:[e.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase",children:"Estado Actual"}),e.jsx("span",{className:i("px-3 py-1 rounded-lg text-sm font-bold uppercase tracking-wider",p[t.status||"pending"]),children:O[t.status||"pending"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-gray-300",children:[e.jsx(_,{size:18,className:"text-blue-500"}),e.jsx("span",{className:"font-bold text-lg",children:t.customer_name})]}),(t.customer_phone||t.customer_email)&&e.jsxs("div",{className:"grid grid-cols-1 gap-3 ml-8 text-sm text-gray-400",children:[t.customer_phone&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{size:14})," ",t.customer_phone]}),t.customer_email&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{size:14})," ",t.customer_email]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-gray-400 ml-1",children:[e.jsx(D,{size:16,className:"text-gray-500"}),e.jsxs("span",{children:[t.num_players," Jugadores (",t.duration_minutes," min)"]})]})]}),t.notes&&e.jsxs("div",{className:"bg-yellow-900/10 border border-yellow-700/30 p-4 rounded-xl",children:[e.jsx("h4",{className:"text-xs font-bold text-yellow-600 uppercase mb-2",children:"Notas"}),e.jsxs("p",{className:"text-sm text-yellow-100/80 italic",children:['"',t.notes,'"']})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 pt-4 border-t border-gray-800",children:[t.id&&t.status!=="cancelled"?e.jsxs("button",{onClick:()=>{confirm("¿Cancelar esta reserva? Quedará en el historial.")&&(j.mutate({id:t.id,status:"cancelled"}),o(null))},className:"col-span-1 bg-red-900/30 hover:bg-red-900/50 text-red-400 border border-red-900/50 py-3 rounded-xl font-bold text-sm transition-colors flex items-center justify-center gap-2",children:[e.jsx(x,{size:16})," Cancelar"]}):e.jsxs("button",{disabled:!0,className:"col-span-1 bg-gray-800 text-gray-500 py-3 rounded-xl font-bold text-sm flex items-center justify-center gap-2 cursor-not-allowed opacity-50",children:[e.jsx(x,{size:16})," Cancelada"]}),t.id&&t.status==="pending"&&e.jsxs("button",{onClick:()=>{j.mutate({id:t.id,status:"confirmed"}),o(null)},className:"col-span-1 bg-green-600 hover:bg-green-500 text-white py-3 rounded-xl font-bold text-sm transition-colors flex items-center justify-center gap-2",children:[e.jsx(I,{size:16})," Confirmar"]}),t.id&&t.status==="confirmed"&&e.jsxs("button",{onClick:()=>{j.mutate({id:t.id,status:"completed"}),o(null)},className:"col-span-1 bg-blue-600 hover:bg-blue-500 text-white py-3 rounded-xl font-bold text-sm transition-colors flex items-center justify-center gap-2",children:[e.jsx($,{size:16})," Completar"]})]})]})]})}),v&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4 animate-in fade-in",children:e.jsxs("div",{className:"bg-gray-900 rounded-2xl p-6 w-full max-w-md border border-gray-700 shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-black text-white uppercase",children:"Nueva Reserva"}),e.jsx("button",{onClick:()=>b(!1),className:"p-2 hover:bg-gray-800 rounded-lg",children:e.jsx(x,{size:20,className:"text-gray-400"})})]}),e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-800 p-3 rounded-lg flex items-center gap-3",children:[e.jsx(C,{size:20,className:"text-blue-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase font-bold",children:"Fecha"}),e.jsx("div",{className:"text-white font-bold",children:l.toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long"})})]}),e.jsx("input",{type:"date",value:l.toISOString().split("T")[0],onChange:s=>N(new Date(s.target.value)),className:"ml-auto bg-gray-700 border-none rounded px-2 py-1 text-white text-sm"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-gray-500 uppercase font-bold block mb-2",children:[e.jsx(K,{size:14,className:"inline mr-1"})," Horario"]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:B?.slots?.map(s=>e.jsx("button",{type:"button",disabled:!s.available,onClick:()=>w(s.time_slot),className:i("p-2 rounded-lg text-xs font-bold transition-all",s.available?m===s.time_slot?"bg-blue-600 text-white":"bg-gray-800 text-white hover:bg-gray-700":"bg-gray-800/50 text-gray-600 cursor-not-allowed"),children:s.time_slot.split("-")[0]},s.time_slot))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-gray-500 uppercase font-bold block mb-1",children:[e.jsx(_,{size:14,className:"inline mr-1"})," Nombre *"]}),e.jsx("input",{type:"text",required:!0,value:r.customer_name,onChange:s=>n({...r,customer_name:s.target.value}),className:"w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"Nombre del cliente"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-gray-500 uppercase font-bold block mb-1",children:[e.jsx(D,{size:14,className:"inline mr-1"})," Nº Jugadores"]}),e.jsx("input",{type:"number",min:1,max:10,value:r.num_players,onChange:s=>n({...r,num_players:parseInt(s.target.value)||1}),className:"w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-blue-500 outline-none"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-gray-500 uppercase font-bold block mb-1",children:[e.jsx(M,{size:14,className:"inline mr-1"})," Duración"]}),e.jsxs("select",{value:r.duration_minutes,onChange:s=>n({...r,duration_minutes:parseInt(s.target.value)}),className:"w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-blue-500 outline-none",children:[e.jsx("option",{value:30,children:"30 minutos"}),e.jsx("option",{value:60,children:"1 hora"}),e.jsx("option",{value:90,children:"1h 30min"}),e.jsx("option",{value:120,children:"2 horas"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-gray-500 uppercase font-bold block mb-1",children:[e.jsx(L,{size:14,className:"inline mr-1"})," Teléfono"]}),e.jsx("input",{type:"tel",value:r.customer_phone,onChange:s=>n({...r,customer_phone:s.target.value}),className:"w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"600 123 456"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-gray-500 uppercase font-bold block mb-1",children:[e.jsx(E,{size:14,className:"inline mr-1"})," Email"]}),e.jsx("input",{type:"email",value:r.customer_email,onChange:s=>n({...r,customer_email:s.target.value}),className:"w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-blue-500 outline-none",placeholder:"cliente@email.com"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500 uppercase font-bold block mb-1",children:"Notas"}),e.jsx("textarea",{value:r.notes,onChange:s=>n({...r,notes:s.target.value}),className:"w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white focus:ring-2 focus:ring-blue-500 outline-none resize-none",rows:2,placeholder:"Notas adicionales..."})]})]}),e.jsxs("button",{type:"submit",disabled:!m||!r.customer_name||h.isPending,className:"w-full py-3 bg-blue-600 hover:bg-blue-500 disabled:bg-gray-700 disabled:cursor-not-allowed text-white font-bold rounded-lg transition-colors flex items-center justify-center gap-2",children:[h.isPending?e.jsx(T,{className:"animate-spin",size:18}):e.jsx(I,{size:18}),"Confirmar Reserva"]})]})]})}),e.jsxs("div",{className:"flex items-center justify-center gap-6 text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-yellow-500"}),e.jsx("span",{children:"Pendiente"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-green-500"}),e.jsx("span",{children:"Confirmada"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-blue-500"}),e.jsx("span",{children:"Completada"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded bg-red-500"}),e.jsx("span",{children:"Cancelada"})]})]})]})}export{re as default};
