import{c as v,r as n,d as z,u as p,j as e,k as f,A as o,T as P,a as c}from"./index-MjGtIaAt.js";import{Q as D}from"./index-BPWuL58u.js";import{u as L}from"./useMutation-Ckz2NycH.js";import{T as y}from"./triangle-alert-ko4KflD0.js";import{C as M}from"./camera-FfIFRMKE.js";import{S as $}from"./star-CL4c2zd3.js";import{C as R}from"./car-Bto1fEN0.js";import{R as T,X as F}from"./CartesianChart-byA6CRUy.js";import{B as q,a as E}from"./BarChart-DzL7O3Yf.js";import{T as I}from"./Tooltip-BKNbpHsn.js";import{S as j}from"./search-l6nyBgHJ.js";import{A as U}from"./award-xLJ3_U0a.js";import"./clsx-B-dksMZM.js";import"./graphicalItemSelectors-DfVAs9is.js";const B=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]],K=v("file-down",B);const Q=[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]],V=v("gift",Q),G=async()=>(await c.get(`${o}/telemetry/drivers`)).data,X=async i=>(await c.get(`${o}/telemetry/pilot/${encodeURIComponent(i)}`)).data;function ne(){const[i,d]=n.useState(""),[a,h]=n.useState(null),b=n.useRef(null),N=z(),{data:x,isLoading:w,error:_}=p({queryKey:["drivers"],queryFn:async()=>{const t=await G();return Array.isArray(t)?t:[]}}),{data:r,isLoading:k,error:C}=p({queryKey:["driverProfile",a],queryFn:()=>X(a),enabled:!!a}),u=L({mutationFn:async t=>{if(!r?.driver_id)throw new Error("Driver ID missing");const l=new FormData;return l.append("file",t),await c.post(`${o}/drivers/${r.driver_id}/photo`,l,{headers:{"Content-Type":"multipart/form-data"}})},onSuccess:()=>{N.invalidateQueries({queryKey:["driverProfile",a]})}}),A=t=>{t.target.files&&t.target.files[0]&&u.mutate(t.target.files[0])},{data:s}=p({queryKey:["driverLoyalty",a],queryFn:async()=>(await c.get(`${o}/loyalty/points/${encodeURIComponent(a)}`)).data,enabled:!!a}),m=n.useMemo(()=>Array.isArray(x)?x.filter(t=>t.driver_name.toLowerCase().includes(i.toLowerCase())):[],[x,i]),g=()=>{h(null),d("")};if(a){if(k)return e.jsxs("div",{className:"min-h-screen bg-gray-950 flex flex-col items-center justify-center text-white",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-blue-500/20 border-t-blue-500 rounded-full animate-spin mb-4"}),e.jsx("p",{className:"text-blue-500 font-bold uppercase tracking-widest text-xs",children:"Cargando Pasaporte..."})]});if(C||!r)return e.jsxs("div",{className:"min-h-screen bg-gray-950 flex flex-col items-center justify-center text-red-500 p-8",children:[e.jsx(y,{size:48,className:"mb-4 opacity-50"}),e.jsx("h2",{className:"text-xl font-black uppercase tracking-widest text-center",children:"Error al cargar perfil"}),e.jsx("button",{onClick:g,className:"mt-6 px-6 py-2 bg-gray-900 border border-gray-800 rounded-xl text-white font-bold uppercase text-xs",children:"Volver"})]});const t=`${window.location.origin}/passport?driver=${encodeURIComponent(a)}`;return e.jsxs("div",{className:"min-h-screen bg-gray-950 text-white pb-safe",children:[e.jsxs("div",{className:"sticky top-0 z-20 bg-gray-900/80 backdrop-blur-md border-b border-gray-800 px-4 py-3 flex items-center justify-between",children:[e.jsx("button",{onClick:g,className:"p-2 -ml-2 text-gray-400 hover:text-white",children:e.jsx(f,{className:"rotate-180",size:24})}),e.jsx("span",{className:"font-bold text-sm tracking-widest uppercase",children:"Driver Passport"}),e.jsx("button",{onClick:()=>window.open(`${o}/exports/passport/${encodeURIComponent(a)}`,"_blank"),className:"p-2 -mr-2 text-green-400 hover:text-green-300 flex items-center gap-1",title:"Descargar PDF",children:e.jsx(K,{size:20})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-900/40 to-gray-900 border border-blue-500/30 rounded-2xl p-6 relative overflow-hidden shadow-2xl",children:[e.jsx("div",{className:"absolute top-0 right-0 p-2 opacity-10",children:e.jsx(D,{value:t,size:100,level:"L",bgColor:"transparent",fgColor:"#ffffff"})}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-gray-800 border-2 border-blue-400 flex items-center justify-center text-3xl font-black mb-3 shadow-lg overflow-hidden",children:r.photo_url?e.jsx("img",{src:`${o}${r.photo_url}`,alt:r.driver_name,className:"w-full h-full object-cover"}):r.driver_name?.charAt(0).toUpperCase()||"?"}),e.jsx("button",{onClick:()=>b.current?.click(),className:"absolute bottom-3 right-0 bg-blue-600 rounded-full p-1.5 border-2 border-gray-900 text-white hover:bg-blue-500 transition-colors",children:e.jsx(M,{size:14})}),e.jsx("input",{type:"file",ref:b,className:"hidden",accept:"image/*",onChange:A}),u.isPending&&e.jsx("div",{className:"absolute inset-0 bg-black/50 rounded-full flex items-center justify-center",children:e.jsx("div",{className:"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin"})})]}),e.jsx("h1",{className:"text-2xl font-black uppercase tracking-tight text-center",children:r.driver_name}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("div",{className:"px-3 py-1 bg-blue-600/20 border border-blue-500/50 rounded-full text-blue-300 text-xs font-bold uppercase tracking-widest",children:r.total_laps>100?"Pro Driver":"Rookie"}),e.jsxs("div",{className:"px-3 py-1 bg-yellow-600/20 border border-yellow-500/50 rounded-full text-yellow-300 text-xs font-bold uppercase tracking-widest flex items-center gap-1",children:[e.jsx(P,{size:10}),"ELO ",Math.round(r.elo_rating||1200)]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mt-6 border-t border-white/10 pt-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-gray-400 text-[10px] uppercase font-bold",children:"Vueltas"}),e.jsx("div",{className:"text-xl font-mono font-bold",children:r.total_laps||0})]}),e.jsxs("div",{className:"text-center border-l border-white/10",children:[e.jsx("div",{className:"text-gray-400 text-[10px] uppercase font-bold",children:"Km Totales"}),e.jsx("div",{className:"text-xl font-mono font-bold",children:Math.round(r.total_km||0)})]}),e.jsxs("div",{className:"text-center border-l border-white/10",children:[e.jsx("div",{className:"text-gray-400 text-[10px] uppercase font-bold",children:"Consist."}),e.jsxs("div",{className:"text-xl font-mono font-bold text-green-400",children:[r.avg_consistency||0,"%"]})]})]})]}),s&&e.jsxs("div",{className:"bg-gradient-to-br from-amber-900/30 to-gray-900 border border-amber-500/30 rounded-2xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"text-amber-400",size:20}),e.jsx("span",{className:"text-xs font-bold uppercase tracking-widest text-gray-400",children:"Puntos de Fidelidad"})]}),e.jsx("div",{className:`px-2 py-0.5 rounded-full text-[10px] font-bold uppercase ${s.tier==="platinum"?"bg-purple-600 text-white":s.tier==="gold"?"bg-amber-500 text-black":s.tier==="silver"?"bg-gray-400 text-black":"bg-amber-800 text-amber-200"}`,children:s.tier})]}),e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl font-black text-amber-400",children:s.points?.toLocaleString()||0}),e.jsx("div",{className:"text-[10px] text-gray-500",children:"puntos disponibles"})]}),s.next_tier&&e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["Próximo nivel: ",e.jsx("span",{className:"text-amber-400 font-bold",children:s.next_tier})]}),e.jsx("div",{className:"w-24 h-1.5 bg-gray-800 rounded-full mt-1 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-amber-600 to-amber-400 rounded-full transition-all",style:{width:`${Math.min(100,(s.total_earned||0)/((s.total_earned||0)+(s.points_to_next_tier||1))*100)}%`}})}),e.jsxs("div",{className:"text-[9px] text-gray-600 mt-0.5",children:[s.points_to_next_tier," pts para ",s.next_tier]})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-white/10 flex items-center justify-between",children:e.jsxs("div",{className:"text-[10px] text-gray-500",children:[e.jsx(V,{size:12,className:"inline mr-1"}),"Total ganados: ",e.jsx("span",{className:"text-white font-bold",children:s.total_earned?.toLocaleString()||0})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-gray-400 text-xs font-bold uppercase tracking-widest ml-1",children:"Últimas Sesiones"}),Array.isArray(r?.recent_sessions)&&r.recent_sessions.length>0?r.recent_sessions.map((l,S)=>e.jsxs("div",{className:"bg-gray-900 border border-gray-800 rounded-xl p-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-sm uppercase",children:l.track_name?.replace(/_/g," ")}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center mt-1",children:[e.jsx(R,{size:10,className:"mr-1"}),l.car_model?.replace(/_/g," ")]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-blue-400 font-mono font-bold text-sm",children:[Math.floor(l.best_lap/6e4),":",Math.floor(l.best_lap%6e4/1e3).toString().padStart(2,"0"),".",(l.best_lap%1e3).toString().padStart(3,"0")]}),e.jsx("div",{className:"text-[10px] text-gray-600 mt-1",children:l.date?new Date(l.date).toLocaleDateString():"N/A"})]})]},S)):e.jsx("div",{className:"p-8 text-center text-gray-600 italic text-xs",children:"Sin historial reciente"})]}),e.jsxs("div",{className:"bg-gray-900 border border-gray-800 rounded-xl p-4",children:[e.jsx("h3",{className:"text-gray-400 text-xs font-bold uppercase tracking-widest mb-4",children:"Progresión (Últimas 5)"}),e.jsx("div",{className:"h-32",children:e.jsx(T,{width:"100%",height:"100%",children:e.jsxs(q,{data:Array.isArray(r.recent_sessions)?r.recent_sessions.slice(0,5).reverse():[],children:[e.jsx(F,{hide:!0}),e.jsx(I,{contentStyle:{backgroundColor:"#111827",border:"1px solid #374151"},labelStyle:{color:"#9CA3AF"},cursor:{fill:"transparent"}}),e.jsx(E,{dataKey:"best_lap",fill:"#3B82F6",radius:[4,4,0,0]})]})})})]})]})]})}return e.jsxs("div",{className:"min-h-screen bg-gray-950 text-white flex flex-col",children:[e.jsxs("div",{className:"p-6 pb-2 sticky top-0 bg-gray-950 z-10",children:[e.jsxs("h1",{className:"text-3xl font-black text-white mb-1 uppercase tracking-tighter",children:[e.jsx("span",{className:"text-blue-600",children:"Assetto"}),e.jsx("span",{className:"ml-1",children:"Passport"})]}),e.jsx("p",{className:"text-gray-500 text-sm mb-6",children:"Tu carrera digital comienza aquí."}),e.jsxs("div",{className:"relative",children:[e.jsx(j,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",size:18}),e.jsx("input",{type:"text",placeholder:"Buscar piloto...",className:"w-full bg-gray-900 border border-gray-800 rounded-xl pl-10 pr-4 py-3 text-white placeholder-gray-600 focus:ring-2 focus:ring-blue-600 outline-none transition-all",value:i,onChange:t=>d(t.target.value)})]})]}),e.jsx("div",{className:"flex-1 px-4 py-4 overflow-y-auto space-y-3",children:w?e.jsxs("div",{className:"text-center py-20 flex flex-col items-center",children:[e.jsx("div",{className:"w-10 h-10 border-4 border-blue-500/20 border-t-blue-500 rounded-full animate-spin mb-4"}),e.jsx("p",{className:"text-blue-500 font-bold uppercase tracking-widest text-[10px]",children:"Cargando pilotos..."})]}):_?e.jsxs("div",{className:"text-center py-20 flex flex-col items-center",children:[e.jsx(y,{size:48,className:"text-red-500/20 mb-4"}),e.jsx("p",{className:"text-red-500/50 font-bold uppercase tracking-widest text-xs",children:"Error al cargar pilotos"})]}):m?.length===0?e.jsxs("div",{className:"text-center text-gray-600 py-20 flex flex-col items-center",children:[e.jsx(j,{size:48,className:"mb-4 opacity-20"}),e.jsx("p",{className:"text-sm font-bold uppercase tracking-widest",children:"No hay pilotos que coincidan"})]}):Array.isArray(m)&&m.map(t=>e.jsxs("button",{onClick:()=>h(t.driver_name),className:"w-full bg-gray-900 hover:bg-gray-800 border border-gray-800 hover:border-blue-500/30 rounded-xl p-4 flex items-center justify-between transition-all group",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-800 group-hover:bg-blue-900/30 flex items-center justify-center text-gray-400 group-hover:text-blue-400 font-black mr-3 transition-colors",children:t.driver_name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-bold text-white group-hover:text-blue-400 transition-colors uppercase",children:t.driver_name}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center",children:[e.jsx(U,{size:10,className:"mr-1"}),t.rank_tier," • ",t.total_laps," Laps"]})]})]}),e.jsx(f,{size:18,className:"text-gray-600 group-hover:text-blue-500"})]},t.driver_name))}),e.jsx("div",{className:"p-4 text-center text-[10px] text-gray-700 font-mono uppercase",children:"Powered by Assetto Manager"})]})}export{ne as default};
