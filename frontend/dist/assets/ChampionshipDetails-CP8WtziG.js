import{c as E,r as p,d as M,u as j,j as e,C as w,n as Q,L as f,T as S,k as R}from"./index-MjGtIaAt.js";import{u as v}from"./useMutation-Ckz2NycH.js";import{a as V,b as _,l as O,d as G,e as $}from"./championships-D6zgKV6G.js";import{c as B,g as H}from"./events-B0MbDJdO.js";import{c as y}from"./utils-BykweIWy.js";import{b as W}from"./telemetry-bBsdFDJe.js";import{S as J}from"./search-l6nyBgHJ.js";import{R as U}from"./refresh-cw-DQN2a5yv.js";import{T as X}from"./triangle-alert-ko4KflD0.js";import{A as Y}from"./arrow-left-PwRceB5D.js";import{F as Z}from"./flag-Cs2ejYuM.js";import{M as ee}from"./medal-9zSXB385.js";import{P as z}from"./plus-Dqq5J1Gg.js";import{M as te}from"./map-pin-BuEIuJfX.js";import{C as ae}from"./clock-DpL4IKBu.js";import"./clsx-B-dksMZM.js";const se=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],A=E("link-2",se);const re=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],ie=E("wand-sparkles",re);function le({trackName:u,onSelect:s,onCancel:o,championshipId:l,eventId:h}){const[g,c]=p.useState(""),[d,b]=p.useState(""),x=M(),{data:m,isLoading:i}=j({queryKey:["recent_sessions",u,g,d],queryFn:()=>W({track_name:u,driver_name:g||void 0,limit:50})}),n=v({mutationFn:async()=>{if(l&&h)return V(l,h)},onSuccess:a=>{a?.count>0?(x.invalidateQueries({queryKey:["championship",l]}),alert(`¡Se han vinculado ${a.count} sesiones automáticamente!`),o()):alert("No se encontraron sesiones coincidentes en el rango de fechas del evento.")}});return e.jsxs("div",{className:"bg-gray-900/90 backdrop-blur-xl border border-white/10 rounded-3xl p-8 shadow-2xl animate-in fade-in zoom-in-95 fill-mode-both",children:[e.jsxs("div",{className:"flex justify-between items-start mb-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-black text-white italic uppercase tracking-tighter flex items-center gap-3",children:[e.jsx(A,{className:"text-yellow-500"})," Vincular Sesión"]}),e.jsxs("p",{className:"text-gray-500 text-sm mt-1 font-bold uppercase tracking-widest",children:["Base de datos: ",u||"Todos los circuitos"]})]}),e.jsx("button",{onClick:o,className:"text-gray-500 hover:text-white transition-colors font-black uppercase text-xs",children:"Cerrar"})]}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(J,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",size:16}),e.jsx("input",{type:"text",placeholder:"Buscar piloto...",value:g,onChange:a=>c(a.target.value),className:"w-full bg-black/40 border border-white/10 rounded-xl pl-10 pr-4 py-2 text-sm text-white focus:border-yellow-500 outline-none"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(w,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",size:16}),e.jsx("input",{type:"date",value:d,onChange:a=>b(a.target.value),className:"bg-black/40 border border-white/10 rounded-xl pl-10 pr-4 py-2 text-sm text-white focus:border-yellow-500 outline-none"})]}),l&&h&&e.jsxs("button",{onClick:()=>n.mutate(),disabled:n.isPending,className:"bg-purple-600 hover:bg-purple-500 text-white px-4 py-2 rounded-xl text-xs font-black uppercase tracking-widest flex items-center gap-2 transition-all shadow-lg shadow-purple-500/20 disabled:opacity-50",children:[n.isPending?e.jsx(U,{className:"animate-spin",size:16}):e.jsx(ie,{size:16}),"Auto-Detectar"]})]}),e.jsx("div",{className:"max-h-[500px] overflow-y-auto space-y-3 pr-2 custom-scrollbar",children:i?e.jsx("div",{className:"py-20 text-center text-gray-500 font-bold uppercase animate-pulse",children:"Buscando sesiones..."}):m?.length===0?e.jsx("div",{className:"py-20 text-center text-gray-600 italic",children:"No se encontraron sesiones recientes."}):Array.isArray(m)&&m.map(a=>e.jsxs("button",{onClick:()=>s(a.id),className:"w-full bg-gray-950 border border-gray-800 rounded-xl p-6 text-left hover:bg-gray-900 transition-all flex justify-between items-center group",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-400 text-[10px] font-black uppercase tracking-widest mb-1 group-hover:text-blue-400 transition-colors",children:(a.track_name||"").replace(/_/g," ")}),e.jsx("div",{className:"text-white font-bold text-lg mb-1",children:a.driver_name}),e.jsx("div",{className:"text-gray-600 text-xs font-mono",children:new Date(a.date).toLocaleString()})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-blue-500 font-mono font-black text-xl mb-1",children:[Math.floor(a.best_lap/6e4),":",Math.floor(a.best_lap%6e4/1e3).toString().padStart(2,"0"),".",(a.best_lap%1e3).toString().padStart(3,"0")]}),e.jsx("div",{className:"text-gray-700 text-[10px] font-black uppercase tracking-widest group-hover:text-gray-500 transition-colors",children:(a.car_model||"").replace(/_/g," ")})]})]},a.id))})]})}function ke(){const{id:u}=Q(),s=parseInt(u||"0"),o=M(),[l,h]=p.useState("standings"),[g,c]=p.useState(!1),[d,b]=p.useState(!1),[x,m]=p.useState(null),[i,n]=p.useState(()=>{const t=new Date,r=new Date(t.getTime()+864e5);return{name:"",description:"",track_name:"",start_date:t.toISOString().slice(0,16),end_date:r.toISOString().slice(0,16),status:"upcoming"}}),{data:a,isLoading:q,error:D}=j({queryKey:["championship",s],queryFn:()=>G(s)}),{data:C,isLoading:F,error:T}=j({queryKey:["championship_standings",s],queryFn:()=>$(s)}),{data:N}=j({queryKey:["events"],queryFn:()=>H()}),L=v({mutationFn:t=>_(s,t),onSuccess:()=>{o.invalidateQueries({queryKey:["championship",s]}),c(!1),b(!1)}}),k=v({mutationFn:async t=>{const r=await B(t);return _(s,r.id)},onSuccess:()=>{o.invalidateQueries({queryKey:["championship",s]}),o.invalidateQueries({queryKey:["events"]}),c(!1),b(!1),n({name:"",description:"",track_name:"",start_date:new Date().toISOString().slice(0,16),end_date:new Date(Date.now()+864e5).toISOString().slice(0,16),status:"upcoming"})}}),P=v({mutationFn:t=>{if(!x)throw new Error("No event selected");return O(s,x,t)},onSuccess:()=>{o.invalidateQueries({queryKey:["championship",s]}),o.invalidateQueries({queryKey:["championship_standings",s]}),m(null)}});if(F||q)return e.jsxs("div",{className:"p-10 text-center text-white flex flex-col items-center justify-center min-h-[400px]",children:[e.jsx("div",{className:"w-10 h-10 border-4 border-yellow-500/20 border-t-yellow-500 rounded-full animate-spin mb-4"}),e.jsx("p",{className:"font-bold text-yellow-500 animate-pulse uppercase tracking-widest text-sm",children:"Cargando clasificación y detalles..."})]});if(D||T||!a)return e.jsxs("div",{className:"p-10 text-center text-white flex flex-col items-center justify-center min-h-[400px]",children:[e.jsx(X,{size:48,className:"text-red-500 mb-4 opacity-50"}),e.jsx("p",{className:"font-bold text-red-400 uppercase tracking-widest text-sm",children:"Error al cargar datos del campeonato"}),e.jsx("p",{className:"text-gray-500 text-xs mt-2 italic font-medium",children:"Revisa la conexión al servidor o si el ID es correcto."}),e.jsx(f,{to:"/championships",className:"mt-8 bg-white/5 hover:bg-white/10 text-white px-6 py-2 rounded-xl border border-white/10 uppercase font-black text-[10px] tracking-widest",children:"Volver a Campeonatos"})]});const K=a.events?.find(t=>t.id===x);return e.jsxs("div",{className:"p-8 max-w-7xl mx-auto min-h-screen",children:[e.jsxs(f,{to:"/championships",className:"inline-flex items-center text-gray-500 hover:text-white mb-8 transition-colors group",children:[e.jsx(Y,{size:20,className:"mr-2 group-hover:-translate-x-1 transition-transform"})," Volver a Campeonatos"]}),e.jsxs("div",{className:"bg-gradient-to-br from-gray-900 via-gray-900 to-black border border-white/5 rounded-3xl p-8 mb-10 relative overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("span",{className:"bg-yellow-500 text-black px-3 py-1 rounded-lg text-[10px] font-black uppercase tracking-widest",children:"Temporada Oficial"}),a.is_active&&e.jsxs("span",{className:"flex items-center gap-1.5 px-2 py-0.5 bg-green-500/10 text-green-400 text-[10px] font-bold rounded-full uppercase border border-green-500/20",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"})," En Vivo"]})]}),e.jsx("h1",{className:"text-6xl font-black text-white italic uppercase tracking-tighter mb-6",children:a.name}),e.jsxs("div",{className:"flex items-center space-x-8 text-gray-400 font-bold",children:[e.jsxs("div",{className:"flex items-center bg-white/5 px-4 py-2 rounded-xl border border-white/5",children:[e.jsx(w,{size:18,className:"mr-3 text-yellow-500"}),e.jsxs("span",{className:"text-sm",children:["Iniciado: ",new Date(a.start_date).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center bg-white/5 px-4 py-2 rounded-xl border border-white/5",children:[e.jsx(Z,{size:18,className:"mr-3 text-blue-400"}),e.jsxs("span",{className:"text-sm font-mono",children:[a.events?.length||0," Carreras"]})]})]})]}),e.jsx(S,{className:"absolute -right-20 -bottom-20 text-white/5 rotate-12",size:400})]}),e.jsxs("div",{className:"flex space-x-2 mb-8 bg-black/40 p-1.5 rounded-2xl border border-white/5 w-fit",children:[e.jsxs("button",{onClick:()=>h("standings"),className:y("px-8 py-3 rounded-xl font-black italic uppercase tracking-tighter transition-all flex items-center gap-2",l==="standings"?"bg-yellow-500 text-black shadow-lg":"text-gray-500 hover:text-white"),children:[e.jsx(ee,{size:18})," Clasificación"]}),e.jsxs("button",{onClick:()=>h("calendar"),className:y("px-8 py-3 rounded-xl font-black italic uppercase tracking-tighter transition-all flex items-center gap-2",l==="calendar"?"bg-yellow-500 text-black shadow-lg":"text-gray-500 hover:text-white"),children:[e.jsx(w,{size:18})," Calendario"]})]}),l==="standings"&&e.jsxs("div",{className:"bg-gray-900/50 backdrop-blur-xl border border-white/5 rounded-3xl overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"p-8 border-b border-white/5 flex justify-between items-center bg-gradient-to-r from-white/5 to-transparent",children:[e.jsxs("h2",{className:"text-3xl font-black text-white uppercase italic tracking-tighter flex items-center gap-4",children:[e.jsx(S,{className:"text-yellow-500",size:32})," Standings Globales"]}),e.jsx("div",{className:"flex items-center gap-2 text-xs font-bold text-gray-500 uppercase tracking-widest bg-black/40 px-4 py-2 rounded-full border border-white/5",children:"Sistema: F1 Standard (25-18-15)"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-black/40 text-gray-500 text-[10px] uppercase tracking-[0.2em] font-black border-b border-white/5",children:[e.jsx("th",{className:"p-6 text-center w-24",children:"Pos"}),e.jsx("th",{className:"p-6",children:"Piloto"}),e.jsx("th",{className:"p-6 text-center",children:"GPs"}),e.jsx("th",{className:"p-6 text-center",children:"Mejor Tiempo"}),e.jsx("th",{className:"p-6 text-center",children:"Pódiums"}),e.jsx("th",{className:"p-6 text-right pr-12",children:"Total Puntos"})]})}),e.jsx("tbody",{className:"divide-y divide-white/5",children:Array.isArray(C)?C.map((t,r)=>e.jsxs("tr",{className:"hover:bg-white/[0.02] transition-colors group",children:[e.jsx("td",{className:"p-6 text-center",children:e.jsx("div",{className:y("w-10 h-10 rounded-xl flex items-center justify-center font-black italic text-lg mx-auto transform transition-transform group-hover:scale-110",r===0?"bg-yellow-500 text-black shadow-[0_0_20px_rgba(234,179,8,0.3)]":r===1?"bg-gray-300 text-black":r===2?"bg-orange-700 text-white":"bg-white/5 text-gray-500"),children:r+1})}),e.jsxs("td",{className:"p-6",children:[e.jsx("div",{className:"font-black text-white text-xl uppercase italic group-hover:text-yellow-500 transition-colors",children:t.driver_name}),e.jsx("div",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-widest mt-1",children:"Pro Driver • Tier 1"})]}),e.jsx("td",{className:"p-6 text-center",children:e.jsx("span",{className:"font-mono text-lg text-white/50",children:t.events_participated})}),e.jsx("td",{className:"p-6 text-center",children:e.jsx("span",{className:"font-mono text-yellow-500/60 font-bold",children:t.best_lap_ever?(t.best_lap_ever/1e3).toFixed(3)+"s":"--"})}),e.jsx("td",{className:"p-6 text-center",children:e.jsxs("div",{className:"flex justify-center gap-1",children:[Array.from({length:t.podiums||0}).map((ne,I)=>e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"},I)),t.podiums===0&&e.jsx("span",{className:"text-gray-700",children:"-"})]})}),e.jsx("td",{className:"p-6 text-right pr-12",children:e.jsxs("div",{className:"font-black text-4xl text-white italic tracking-tighter tabular-nums",children:[t.total_points,e.jsx("span",{className:"text-[10px] text-gray-500 ml-2 not-italic font-black opacity-40 uppercase",children:"Pts"})]})})]},t.driver_name)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"p-20 text-center text-gray-600 italic",children:"No hay datos de clasificación todavía."})})})]})})]}),l==="calendar"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("h2",{className:"text-3xl font-black text-white uppercase italic tracking-tighter flex items-center gap-4",children:[e.jsx(w,{className:"text-blue-400",size:32})," Calendario de Carrera"]}),e.jsxs("button",{onClick:()=>c(!0),className:"bg-white/5 hover:bg-white/10 text-white font-bold py-3 px-6 rounded-2xl border border-white/10 flex items-center gap-2 transition-all",children:[e.jsx(z,{size:20})," Añadir Carrera"]})]}),g&&e.jsxs("div",{className:"bg-gray-800 border border-gray-700 p-8 rounded-3xl mb-10 animate-in fade-in slide-in-from-top-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white uppercase italic tracking-widest",children:d?"Crear Nueva Carrera":"Seleccionar Evento Existente"}),e.jsx("button",{onClick:()=>b(!d),className:"text-xs font-black uppercase tracking-widest text-yellow-500 hover:text-yellow-400 underline underline-offset-4",children:d?"Volver a Selección":"¿No existe? Crear uno nuevo"})]}),d?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black text-gray-500 uppercase ml-1",children:"Nombre de la Carrera"}),e.jsx("input",{className:"w-full bg-black/40 border border-white/10 p-3 rounded-xl text-white outline-none focus:border-yellow-500 transition-colors",placeholder:"Ej: Gran Premio de Monza",value:i.name,onChange:t=>n({...i,name:t.target.value})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black text-gray-500 uppercase ml-1",children:"Circuito"}),e.jsx("input",{className:"w-full bg-black/40 border border-white/10 p-3 rounded-xl text-white outline-none focus:border-yellow-500 transition-colors",placeholder:"Ej: Monza",value:i.track_name,onChange:t=>n({...i,track_name:t.target.value})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black text-gray-500 uppercase ml-1",children:"Fecha Inicio"}),e.jsx("input",{type:"datetime-local",className:"w-full bg-black/40 border border-white/10 p-3 rounded-xl text-white outline-none focus:border-yellow-500 transition-colors",value:i.start_date,onChange:t=>n({...i,start_date:t.target.value})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-black text-gray-500 uppercase ml-1",children:"Fecha Fin"}),e.jsx("input",{type:"datetime-local",className:"w-full bg-black/40 border border-white/10 p-3 rounded-xl text-white outline-none focus:border-yellow-500 transition-colors",value:i.end_date,onChange:t=>n({...i,end_date:t.target.value})})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{onClick:()=>c(!1),className:"px-6 py-2 text-xs font-black text-gray-500 uppercase hover:text-white transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:()=>k.mutate(i),disabled:k.isPending||!i.name,className:"bg-yellow-500 text-black px-8 py-2 rounded-xl text-xs font-black uppercase tracking-widest hover:bg-yellow-400 transition-all disabled:opacity-50",children:k.isPending?"Guardando...":"Crear y Añadir"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 italic font-bold",children:[N?.filter(t=>!a.events?.some(r=>r.id===t.id)).map(t=>e.jsxs("button",{onClick:()=>L.mutate(t.id),className:"p-4 bg-black/40 border border-white/5 rounded-2xl text-left hover:border-yellow-500 transition-all flex justify-between items-center group",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-white group-hover:text-yellow-500 transition-colors uppercase",children:t.name}),e.jsx("div",{className:"text-xs text-gray-500 mt-1 uppercase tracking-widest",children:t.track_name})]}),e.jsx(z,{className:"text-gray-600 group-hover:text-yellow-500",size:20})]},t.id)),(!N||N.filter(t=>!a.events?.some(r=>r.id===t.id)).length===0)&&e.jsx("div",{className:"col-span-full py-10 text-center text-gray-500 font-medium",children:"No hay otros eventos disponibles para añadir."})]}),e.jsx("button",{onClick:()=>c(!1),className:"mt-8 text-sm text-gray-500 hover:text-white uppercase font-black",children:"Cancelar"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[Array.isArray(a.events)&&a.events.map((t,r)=>e.jsxs("div",{className:"group bg-gray-900 border border-white/5 rounded-2xl p-6 flex items-center gap-8 hover:bg-white/[0.02] transition-all",children:[e.jsxs("div",{className:"w-12 h-12 bg-white/5 rounded-xl flex items-center justify-center font-black italic text-gray-500 border border-white/5",children:["R",r+1]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(f,{to:`/events/${t.id}`,className:"text-2xl font-black text-white uppercase italic group-hover:text-yellow-500 transition-colors",children:t.name}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-gray-500 text-xs font-bold uppercase tracking-widest",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(te,{size:12})," ",t.track_name]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ae,{size:12})," ",new Date(t.start_date).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-right px-6 border-r border-white/5",children:[e.jsx("div",{className:"text-[10px] font-black text-gray-600 uppercase mb-1",children:"Status"}),e.jsx("div",{className:y("text-sm font-bold uppercase",t.results&&t.results.length>0?"text-green-500":"text-yellow-500"),children:t.results&&t.results.length>0?"Con Resultados":"Pendiente"})]}),e.jsxs("button",{onClick:()=>m(t.id),className:"bg-white/5 hover:bg-yellow-500 hover:text-black text-white p-3 rounded-xl border border-white/10 transition-all flex items-center gap-2 group/btn",children:[e.jsx(A,{size:20}),e.jsx("span",{className:"text-xs font-black uppercase tracking-widest opacity-0 group-hover/btn:opacity-100 transition-opacity",children:"Vincular"})]}),e.jsx(f,{to:`/events/${t.id}`,children:e.jsx(R,{className:"text-gray-700 hover:text-white transition-colors",size:24})})]})]},t.id)),(!Array.isArray(a.events)||a.events.length===0)&&e.jsx("div",{className:"py-20 text-center bg-gray-900/50 rounded-3xl border border-dashed border-white/5 italic text-gray-500",children:"No hay carreras programadas en este campeonato."})]})]}),x&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-8 bg-black/80 backdrop-blur-sm",children:e.jsx("div",{className:"w-full max-w-2xl",children:e.jsx(le,{trackName:K?.track_name,onSelect:t=>P.mutate(t),onCancel:()=>m(null),championshipId:s,eventId:x})})})]})}export{ke as default};
